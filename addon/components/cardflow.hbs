<CardPlatter @class="cardflow">
    <header class="cardflow__header">
      {{#if (eq this.project.status "unread")}}
        <div class="cardflow__notification">1</div>
      {{/if}}
      <div>
        <div class="cardflow__label">{{this.thread.project}}</div>
        <h2 class="cardflow__title">{{or this.thread.description this.thread.title}}</h2>
      </div>
      <div class="cardflow__header-participants">
        <span>{{this.participants.length}} {{svg-jar "users" width="15px" height="13px"}}</span>
        <div class="cardflow__header-participant-icons">
          {{#each this.participants as |user|}}
            <div class="cardflow__header-participant-img" style={{css-url "background-image" user.imgURL}} />
          {{/each}}
        </div>
      </div>
    </header>

    {{!-- Main Thread --}}
    <div class="cardflow__thread">
      {{#each @model.posts as |post|}}
        <div class="cardflow__message">
          <div class="cardflow__message-icon__profile cardflow__message-icon__profile--{{post.participantType}}" style={{css-url "background-image" post.sender.imgURL}} />
          <div class="cardflow__message-info">
            <div class="cardflow__message-sender">{{post.sender.title}}</div>
            <time class="cardflow__message-time">{{moment-format post.datetime "MMM D, h:m A"}}</time>
            <div class="cardflow__message-sender-role">{{if (eq post.participantType "bot") "Bot" post.sender.role}}</div>
          </div>
          <div />
          <div class="cardflow__message-content">
            {{post.content}}
          </div>
        </div>
      {{/each}}

      {{!-- Reply to message box --}}
      <div class="cardflow__message">
        <div class="cardflow__message-icon__profile" style={{css-url "background-image" @model.user.imgURL}} />
        <Input @class="cardflow__reply-to field-renderer__input" @placeholder="Post a message to this thread"></Input>
      </div>
    </div>

    {{!-- Right Sidebar --}}
    <aside class="cardflow__sidebar">
      {{#if this.workflow}}
        {{!-- Progress Pie --}}
        <CardPlatter @class="cardflow-platter">
          <section class="cardflow__sidebar-section">
            <h3 class="cardflow__sidebar-title">Workflow Progress</h3>
            <div class="cardflow__progress">
              <div class="cardflow__progress-icon" style={{css-url "background-image" @currentMilestone.iconLg}}>
                <span class="cardflow__progress-pct">{{@currentMilestone.pct}}%</span>
              </div>
              <div class="cardflow__progress-status">{{@currentMilestone.desc}}Status</div>
            </div>
          </section>

          {{!-- Milestones --}}
          <section class="cardflow__sidebar-section">
            <h3 class="cardflow__sidebar-title">Milestones</h3>
            <ul class="cardflow__checklist">
              <li class="cardflow__checklist-item {{if (gt @currentMilestone.pct 0) "completed" (if (eq @currentMilestone.pct 0) "current")}}">
                  {{svg-jar (if (gt @currentMilestone.pct 0) "checkmark-lg" "checklist-circle") width="16px" height="16px"}} Propose
                  <br>
                  <span class="cardflow__checklist-time">12h ago</span>
              </li>
              <li class="cardflow__checklist-item {{if (gt @currentMilestone.pct 20) "completed" (if (eq @currentMilestone.pct 20) "current")}}">
                {{svg-jar (if (gt @currentMilestone.pct 20) "checkmark-lg" "checklist-circle") width="16px" height="16px"}} Review
                {{#if (gt @currentMilestone.pct 20)}}<span class="cardflow__checklist-time">1d ago</span>{{/if}}
              </li>
              <li class="cardflow__checklist-item {{if (gt @currentMilestone.pct 40) "completed" (if (eq @currentMilestone.pct 40) "current")}}">
                {{svg-jar (if (gt @currentMilestone.pct 40) "checkmark-lg" "checklist-circle") width="16px" height="16px"}} Accept
                {{#if (gt @currentMilestone.pct 40)}}<span class="cardflow__checklist-time">10m ago</span>{{/if}}
              </li>
              <li class="cardflow__checklist-item {{if (gt @currentMilestone.pct 60) "completed" (if (eq @currentMilestone.pct 60) "current")}}">
                {{svg-jar (if (gt @currentMilestone.pct 60) "checkmark-lg" "checklist-circle") width="16px" height="16px"}} Amend
                {{#if (gt @currentMilestone.pct 60)}}<span class="cardflow__checklist-time">5m ago</span>{{/if}}
              </li>
              <li class="cardflow__checklist-item {{if (gt @currentMilestone.pct 80) "completed" (if (eq @currentMilestone.pct 80) "current")}}">
                {{svg-jar (if (gt @currentMilestone.pct 80) "checkmark-lg" "checklist-circle") width="16px" height="16px"}} Redeliver
                {{#if (gt @currentMilestone.pct 80)}}<span class="cardflow__checklist-time">1m ago</span>{{/if}}
              </li>
            </ul>
          </section>
        </CardPlatter>
      {{/if}}

      {{!-- Participants Box --}}
      <CardPlatter @class="cardflow-platter">
        <section class="cardflow__sidebar-section cardflow__sidebar-section--participants">
          <h3 class="cardflow__sidebar-title">Participants</h3>
          {{#if this.otherParticipants}}
            <ul class="cardflow__participants">
              {{#each this.otherParticipants as |participant|}}
                <li class="cardflow__participant">
                  <div class="cardflow__participant-img" style={{css-url "background-image" participant.imgURL}} />
                  <div class="cardflow__participant-title">
                    {{participant.title}}
                    <div class="cardflow__participant-role">{{participant.role}}</div>
                  </div>
                </li>
              {{/each}}
            </ul>
          {{/if}}
          <ul class="cardflow__participants">
            <li class="cardflow__participant cardflow__participant-org">
              <div class="cardflow__participant-org-img" style={{css-url "background-image" this.org.imgURL}} />
              <div class="cardflow__participant-org-title">{{this.org.title}}</div>
            </li>
            {{#each this.participatingOrgMembers as |participant|}}
              <li class="cardflow__participant">
                <div class="cardflow__participant-img" style={{css-url "background-image" participant.imgURL}} />
                <div class="cardflow__participant-title">
                  {{participant.title}}
                  <div class="cardflow__participant-role">{{participant.role}}</div>
                </div>
              </li>
            {{/each}}
          </ul>
        </section>
      </CardPlatter>
    </aside>
</CardPlatter>