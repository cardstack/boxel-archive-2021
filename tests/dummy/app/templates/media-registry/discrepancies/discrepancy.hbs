<section class="discrepancy" {{did-insert this.reset}}>
  <div class="discrepancy__container">
    <header class="discrepancy__header">
      <h1 class="discrepancy__title">Discrepancy Card: Missing Data</h1>
      <div class="discrepancy__mode-btn">
        <LinkTo @route="media-registry.item.musical-work" @model={{@model.baseCard}} @class="mode-indicator mode-indicator--revision">
          Comparison Mode
        </LinkTo>
      </div>
    </header>

    <Breadcrumbs>
      <LinkTo @route="media-registry" @class="breadcrumbs__item breadcrumbs__item--inverse">
        <div class="breadcrumbs__item-label">Collection</div>
        <div class="breadcrumbs__item-title">Master Recordings</div>
      </LinkTo>
      <span class="breadcrumbs__carot" />
      <LinkTo @route="media-registry.item" @model={{@model.baseCard.itemId}} @class="breadcrumbs__item breadcrumbs__item--inverse">
        <div class="breadcrumbs__item-label">Master Detail</div>
        <div class="breadcrumbs__item-title">{{@model.baseCard.title}}</div>
      </LinkTo>
      <span class="breadcrumbs__carot" />
      <LinkTo @route="media-registry.item.musical-work" @model={{@model.baseCard.itemId}} @class="breadcrumbs__item breadcrumbs__item--inverse">
        <div class="breadcrumbs__item-label">Musical Work</div>
        <div class="breadcrumbs__item-title">{{@model.baseCard.title}}</div>
      </LinkTo>
    </Breadcrumbs>

    <div class="discrepancy__main">
      <div class="discrepancy__reconcile-button">
        Reconcile between these 2 versions
      </div>
      <div class="discrepancy__cards">
        <div class="discrepancy-card__header">
          <div class="discrepancy-card__title">{{@model.baseCard.owner}}</div>
          <datetime>{{moment-format @model.baseCard.datetime "MMM D YYYY, h:mm A"}}</datetime>
        </div>
        <div class="discrepancy-card__header">
          <div class="discrepancy-card__title">{{@model.compCard.owner}}</div>
          <datetime>{{moment-format @model.compCard.datetime "MMM D YYYY, h:mm A"}}</datetime>
        </div>
        {{#each @model.baseCard.isolatedFields as |field|}}
          <div class="discrepancy-field">
            <FieldRenderer
              @mode="view"
              @class="base-card"
              @field={{or field.new field}}
              @comparisonMode={{field.new}}
              @discrepancyView={{field.new}}
              @expandAction={{@expandAction}}
              @addedValues={{this.addedValues}}
              @changedFields={{this.changedFields}}
              @addedCards={{this.addedCards}}
              @modifiedValues={{this.modifiedValues}}
              @modifiedCards={{this.modifiedCards}}
              @removedValues={{this.removedValues}}
            />
            {{#if field.new}}
              <IconButton @class="discrepancy-field__btn discrepancy-field__btn--revert" @icon="carot" {{on "click" (fn this.revertField field)}} />
            {{/if}}
          </div>
          <div class="discrepancy-field">
            {{#with (find-by "title" field.title @model.compCard.isolatedFields) as |compField|}}
              {{#if (not (is-equal field.value compField.value) (eq field.title "verifi_id"))}}
                {{#with (compute (fn this.compareFields field compField)) as |return|}}
                  {{#if return}}
                    {{#unless field.new}}
                      <IconButton @class="discrepancy-field__btn" @icon="carot" @variant="primary" {{on "click" (fn this.reconciliateField field compField)}} />
                    {{/unless}}
                    <FieldRenderer
                      @mode="view"
                      @class="comp-card"
                      @comparisonMode={{not field.new}}
                      @discrepancyView={{not field.new}}
                      @field={{compField}}
                      @addedValues={{this.addedValues}}
                      @changedFields={{this.changedFields}}
                      @addedCards={{this.addedCards}}
                      @modifiedValues={{this.modifiedValues}}
                      @modifiedCards={{this.modifiedCards}}
                      @removedValues={{this.removedValues}}
                    />
                  {{/if}}
                {{/with}}
              {{/if}}
            {{/with}}
          </div>
        {{/each}}

        <div class="discrepancy-card__footer">
          <div class="discrepancy__count-btn-container {{if this.count "visible"}}">
            {{#if this.count}}
              <PillButton @class="discrepancy__count-btn" @variant="primary">
                {{#if (eq this.count 1)}}
                  Make 1 change to your version
                {{else}}
                  Make {{this.count}} changes to your version
                {{/if}}
              </PillButton>
            {{/if}}
          </div>
        </div>

        <div class="discrepancy-card__footer"></div>
      </div>
    </div>
  </div>
</section>