{{#if (eq @mode "edit")}}
  <div class="edit-field edit-field--{{dasherize @fieldName}}-field" data-test-edit-field="collection-editors">
    <div class="edit-field__title">{{humanize (dasherize @fieldName)}}</div>
    <div class="edit-field__value">
      {{#if (eq @format "tagList")}}
        <Boxel>
          <BoxelHighlight @on={{this.collectionSelected}} {{on "click" this.collectionSelect}} />
          <BoxelActions @displayHighlightActions={{this.collectionSelected}} />
          <div class="collection-editor collection-taglist-editor">
            <ul class="collection-taglist-editor__list">
              {{#each this.collection as |item|}}
                <Boxel>
                  <BoxelHighlight @on={{item.selected}} {{on "click" (fn this.itemSelect item.id)}} />
                  <BoxelActions @displayHighlightActions={{item.selected}} />
                  <li class="collection-taglist-editor__list-item">
                    <span class="collection-taglist-editor__text">{{item.title}}</span>
                    <button class="collection-taglist-editor__btn remove-btn" aria-label="remove">{{svg-jar "close" width="8px" height="8px"}}</button>
                  </li>
                </Boxel>
              {{/each}}
            </ul>
            <button class="collection-taglist-editor__btn add-btn" aria-label="add">{{svg-jar "icon-plus-circle" width="16px" height="16px"}}</button>
          </div>
        </Boxel>
      {{else}}
        <Boxel>
          <BoxelHighlight @on={{this.collectionSelected}} {{on "click" this.collectionSelect}} data-test-collection={{@format}} />
          <BoxelActions @displayHighlightActions={{this.collectionSelected}} data-test-collection-actions={{@format}} />
          <div class="collection-editor collection-editor--{{@format}}">
            <h4>{{@title}} ({{this.collection.length}})</h4>
            {{#if this.collectionSelected}}
              <div class="collection-editor__select">
                <button {{on "click" this.toggleSelectAll}} class="collection-editor__select-btn" aria-label="Select all" data-test-collection-select-all>
                  {{#if this.selectedAll}}
                    {{svg-jar "icon-circle-selected" class="collection-editor__select--selected" width="16px" height="16px"}}
                  {{else}}
                    {{svg-jar "icon-circle" class=(if this.pickedItems "collection-editor__select--partial") width="16px" height="16px"}}
                  {{/if}}
                </button>
                <div class="collection-editor__select-all" data-test-collection-selected-count>
                  {{#if this.pickedItems}}
                    {{this.pickedItems}} selected
                  {{else}}
                    Select all
                  {{/if}}
                </div>
              </div>
            {{/if}}
            {{#each this.collection as |item i|}}
              <div class="collection-editor__item {{if (and this.collectionSelected (eq @format "list")) "collection-editor__select"}}">
                {{#if (and this.collectionSelected (eq @format "list"))}}
                  <button {{on "click" (fn this.togglePick item.id)}} class="collection-editor__select-btn" aria-label="select" data-test-collection-select-item={{i}}>
                    {{#if item.picked}}
                      {{svg-jar "icon-circle-selected" class="collection-editor__select--selected" width="16px" height="16px"}}
                    {{else}}
                      {{svg-jar "icon-circle" width="16px" height="16px"}}
                    {{/if}}
                  </button>
                {{/if}}
                <Boxel>
                  <BoxelHighlight @on={{or item.selected item.picked}} {{on "click" (fn this.itemSelect item.id)}} data-test-collection-item={{i}} />
                  <BoxelActions @displayHighlightActions={{item.selected}} data-test-collection-item-actions={{i}} />
                  {{#let @component as |Component|}}
                    <Component @content={{item}} @mode={{@mode}} />
                  {{/let}}
                </Boxel>
                {{#if (and this.collectionSelected (eq @format "grid"))}}
                  <div class="collection-editor__btn-group">
                    <button {{on "click" (fn this.togglePick item.id)}} class="collection-editor__select-btn" aria-label="select" data-test-collection-select-item={{i}}>
                      {{#if item.picked}}
                        {{svg-jar "icon-circle-selected" class="collection-editor__select--selected" width="16px" height="16px"}}
                      {{else}}
                        {{svg-jar "icon-circle" width="16px" height="16px"}}
                      {{/if}}
                    </button>
                    <button {{on "click" (fn this.removeItem item.id)}} class="collection-editor__select-btn" aria-label="remove">{{svg-jar "icon-minus-circle" width="16px" height="16px"}}</button>
                  </div>
                {{/if}}
                {{#if (and this.collectionSelected (eq @format "list"))}}
                  <button {{on "click" (fn this.removeItem item.id)}} class="collection-editor__select-btn" aria-label="remove">{{svg-jar "icon-minus-circle" width="16px" height="16px"}}</button>
                {{/if}}
              </div>
            {{/each}}
            <button class="collection-editor__view-all-btn">View all ({{this.collection.length}})</button>
            <button class="collection-editor__add-btn">{{svg-jar "icon-plus-circle" width="18px" height="18px"}}</button>
          </div>
        </Boxel>
      {{/if}}
    </div>
  </div>
{{else}}
  {{#if (eq @format "tagList")}}
    {{#each @field.value as |genre i|}}
      {{#if (eq i (sub @field.value.length 1))}}
        {{genre.title}}
      {{else}}
        {{genre.title}},
      {{/if}}
    {{/each}}
  {{else if (eq @format "grid")}}
    <div class="collection-grid" data-test-view-field="collection-grid">
      {{#each @field.value as |item|}}
        <div class="collection-grid__item">
          <img src="/assets/images/{{item.src}}" alt={{item.altText}}>
        </div>
      {{/each}}
    </div>
  {{else if (eq @format "list")}}
    <div class="collection-list" data-test-view-field="collection-list">
      {{#each this.collection as |item|}}
        <Actor @content={{item}} />
      {{/each}}
    </div>
  {{/if}}
{{/if}}